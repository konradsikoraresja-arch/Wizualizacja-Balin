<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizualizacja pracy filtrów biogazu Balin</title>
    
    <!-- Stylizacja Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel do obsługi JSX w przeglądarce -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Animacja migania dla ostrzeżenia */
        @keyframes flash-warning {
            0% { fill: #f97316; opacity: 1; }
            50% { fill: #fbbf24; opacity: 0.9; } 
            100% { fill: #f97316; opacity: 1; }
        }
        /* Animacja migania tekstu */
        @keyframes flash-text {
            0% { fill: #dc2626; font-weight: 900; }
            50% { fill: #991b1b; font-weight: 700; }
            100% { fill: #dc2626; font-weight: 900; }
        }
        .animate-flash-rect {
            animation: flash-warning 1s infinite;
        }
        .animate-flash-text {
            animation: flash-text 1s infinite;
        }
    </style>
</head>
<body class="p-4 flex justify-center min-h-screen">

    <div id="root" class="w-full max-w-7xl"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- IKONY SVG ---
        const IconSettings = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        );
        const IconFileText = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-slate-700"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        );
        const IconAlert = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-600"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
        );
        const IconWarningSmall = () => (
             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-600 mt-0.5"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        );

        // --- KOMPONENT LOGO ENERIS (TEXT) ---
        const EnerisLogo = () => (
            <div className="flex items-center gap-4">
                <div className="text-3xl font-black text-green-700 tracking-tight" style={{fontFamily: 'Verdana, sans-serif'}}>
                    ENERIS BALIN
                </div>
                <div className="h-10 w-px bg-slate-300 mx-2"></div>
            </div>
        );

        // --- GŁÓWNA APLIKACJA ---
        const ProcessDiagram = () => {
            // --- STAN ZAWORÓW ---
            const [valves, setValves] = useState({
                f1_in: true,  f1_out: true,  f1_byp: false,
                f2_in: true,  f2_out: true,  f2_byp: false,
                f3_in: true,  f3_out: true,  f3_byp: false,
            });

            // --- STAN DMUCHAW ---
            const [pumps, setPumps] = useState({
                p1: true,
                p2: false
            });

            // --- STAN SERWISOWY FILTRÓW ---
            const [maintenanceAck, setMaintenanceAck] = useState({
                1: false, 2: false, 3: false
            });
            // Statusy: 'IDLE', 'ACKNOWLEDGED' (serwis w toku), 'RESTORING' (przywracanie)
            const [maintenanceStatus, setMaintenanceStatus] = useState({
                1: 'IDLE', 2: 'IDLE', 3: 'IDLE'
            });

            const toggleValve = (id) => {
                setValves(prev => {
                    const newState = { ...prev, [id]: !prev[id] };
                    // Reset statusu jeśli zamykamy bajpas (powrót do normy)
                    if (id.endsWith('_byp') && !newState[id]) {
                        const fId = parseInt(id.charAt(1));
                        setMaintenanceStatus(curr => ({...curr, [fId]: 'IDLE'}));
                    }
                    return newState;
                });
            };

            const togglePump = (id) => {
                setPumps(prev => ({ ...prev, [id]: !prev[id] }));
            };

            const advanceMaintenance = (id) => {
                setMaintenanceStatus(prev => {
                    const current = prev[id];
                    if (current === 'IDLE') return { ...prev, [id]: 'ACKNOWLEDGED' };
                    if (current === 'ACKNOWLEDGED') return { ...prev, [id]: 'RESTORING' };
                    return prev; 
                });
            };

            // --- LOGIKA ALARMÓW PRZY ZAWORACH ---
            const getValveAlert = (valveId) => {
                const match = valveId.match(/f(\d)_(\w+)/);
                if (!match) return null;
                const [_, fIdStr, type] = match;
                const fId = parseInt(fIdStr);
                const status = maintenanceStatus[fId];
                const isValveOpen = valves[valveId];

                // Scenariusz: Potwierdzono serwis -> Pytamy czy zamknięto
                if (status === 'ACKNOWLEDGED') {
                    if ((type === 'in' || type === 'out') && isValveOpen) {
                        return ["Czy zamknąłeś zawór?", "Jeśli tak, potwierdź klikając"];
                    }
                }
                
                // Scenariusz: Przywracanie
                if (status === 'RESTORING') {
                    if ((type === 'in' || type === 'out') && !isValveOpen) {
                        return ["Czy otworzyłeś zawór?", "Kliknij, aby potwierdzić"];
                    }
                    const inletOpen = valves[`f${fId}_in`];
                    const outletOpen = valves[`f${fId}_out`];
                    if (inletOpen && outletOpen && type === 'byp' && isValveOpen) {
                        return ["Zamknij Bajpas", "Kliknij, aby potwierdzić"];
                    }
                }
                return null;
            };

            // --- DIAGNOSTYKA ZAWORÓW ---
            const valveWarnings = useMemo(() => {
                const warnings = [];
                [1, 2, 3].forEach(id => {
                    const i = valves[`f${id}_in`];
                    const o = valves[`f${id}_out`];
                    const b = valves[`f${id}_byp`];
                    const status = maintenanceStatus[id];

                    if (status !== 'RESTORING') {
                        if (i && o && b && status !== 'ACKNOWLEDGED') {
                            warnings.push(`Filtr ${id}: Niepotrzebnie otwarty BYPASS. Potwierdź tryb serwisowy.`);
                        }
                        else if (i && !o) warnings.push(`Filtr ${id}: Otwarty WLOT, zamknięty WYLOT.`);
                        else if (!i && o) warnings.push(`Filtr ${id}: Otwarty WYLOT, zamknięty WLOT.`);
                    }
                });
                return warnings;
            }, [valves, maintenanceStatus]);

            // --- SCENARIUSZE ---
            const currentScenario = useMemo(() => {
                const getFilterStatus = (id) => {
                    const i = valves[`f${id}_in`];
                    const o = valves[`f${id}_out`];
                    const b = valves[`f${id}_byp`];
                    if (i && o && !b) return { status: 'WORK', label: `F${id}: PRACA`, color: 'text-green-700' };
                    if (!i && !o && b) return { status: 'SERVICE', label: `F${id}: BYPASS`, color: 'text-blue-700' };
                    if (!i && !o && !b) return { status: 'CLOSED', label: `F${id}: ODCIĘTY`, color: 'text-gray-500' };
                    return { status: 'ERROR', label: `F${id}: BŁĄD`, color: 'text-red-600' };
                };

                const s1 = getFilterStatus(1);
                const s2 = getFilterStatus(2);
                const s3 = getFilterStatus(3);
                const hasError = valveWarnings.length > 0;

                let barColor = "bg-white text-gray-800 border-gray-300";
                let statusText = `${s1.label}  |  ${s2.label}  |  ${s3.label}`;
                let scenarioId = 0;

                if (hasError) {
                    return { text: "UWAGA: WYMAGANA INTERWENCJA OPERATORA", color: "bg-red-100 text-red-800 border-red-300", showIcon: true, id: 0 };
                }

                const workCount = [s1, s2, s3].filter(s => s.status === 'WORK').length;
                const bypassCount = [s1, s2, s3].filter(s => s.status === 'SERVICE').length;

                if (workCount === 3) { barColor = "bg-green-100 text-green-900 border-green-300"; scenarioId = 1; }
                else if (bypassCount === 3) { barColor = "bg-red-100 text-red-900 border-red-300"; scenarioId = 8; }
                else if (workCount === 2 && bypassCount === 1) {
                    barColor = "bg-blue-50 text-blue-900 border-blue-200";
                    if (s1.status === 'SERVICE') scenarioId = 2;
                    else if (s2.status === 'SERVICE') scenarioId = 3;
                    else if (s3.status === 'SERVICE') scenarioId = 4;
                } else if (workCount === 1 && bypassCount === 2) {
                    barColor = "bg-orange-50 text-orange-900 border-orange-200";
                    if (s1.status === 'WORK') scenarioId = 5;
                    else if (s2.status === 'WORK') scenarioId = 6;
                    else if (s3.status === 'WORK') scenarioId = 7;
                } else {
                    barColor = "bg-gray-100 text-gray-800 border-gray-300";
                }

                return { text: statusText, color: barColor, showIcon: false, id: scenarioId };
            }, [valves, valveWarnings]);

            const hasGasInlet = true;
            const isP1Working = hasGasInlet && pumps.p1;
            const isP2Working = hasGasInlet && pumps.p2;
            const hasGasAfterPumps = isP1Working || isP2Working;
            const flowIntoF1 = hasGasAfterPumps && valves.f1_in;
            const flowThroughF1 = flowIntoF1 && valves.f1_out;
            const flowBypassF1 = hasGasAfterPumps && valves.f1_byp;
            const hasGasAfterF1 = flowThroughF1 || flowBypassF1;
            const flowIntoF2 = hasGasAfterF1 && valves.f2_in;
            const flowThroughF2 = flowIntoF2 && valves.f2_out;
            const flowBypassF2 = hasGasAfterF1 && valves.f2_byp;
            const hasGasAfterF2 = flowThroughF2 || flowBypassF2;
            const flowIntoF3 = hasGasAfterF2 && valves.f3_in;
            const flowThroughF3 = flowIntoF3 && valves.f3_out;
            const flowBypassF3 = hasGasAfterF2 && valves.f3_byp;
            const hasGasAfterF3 = flowThroughF3 || flowBypassF3;
            const hasGasOutlet = hasGasAfterF3;

            // --- KOMPONENTY SVG ---
            const Pipe = ({ d, active, thick = 6 }) => (
                <path d={d} fill="none" stroke={active ? "#2563eb" : "#94a3b8"} strokeWidth={thick} strokeLinecap="round" strokeLinejoin="round" className="transition-colors duration-500 ease-in-out" />
            );

            const Valve = ({ x, y, id, isOpen, code, vertical = false, scale = 1, alertLines }) => (
                <g transform={`translate(${x},${y}) scale(${scale})`} onClick={() => toggleValve(id)} className="cursor-pointer hover:opacity-80 transition-opacity group">
                    <rect x="-18" y="-28" width="36" height="14" rx="2" fill="white" stroke="#cbd5e1" strokeWidth="1" />
                    <text x="0" y="-18" textAnchor="middle" className="text-[9px] font-bold font-mono fill-slate-700 pointer-events-none">{code}</text>
                    <circle r="8" fill={isOpen ? "#bbf7d0" : "#fecaca"} stroke={isOpen ? "#16a34a" : "#dc2626"} strokeWidth="2" />
                    <g transform={`rotate(${isOpen ? (vertical ? 90 : 0) : (vertical ? 0 : 90)})`} className="transition-transform duration-300">
                        <rect x="-12" y="-3" width="24" height="6" rx="2" fill={isOpen ? "#16a34a" : "#dc2626"} stroke="none" />
                        <circle r="2" fill="white" opacity="0.5" />
                    </g>
                    {/* MIGAJĄCY DYMEK Z PYTANIEM */}
                    {alertLines && (
                        <g transform="translate(0, 32)">
                             <rect x="-70" y="-12" width="140" height="28" rx="4" fill="white" stroke="#dc2626" strokeWidth="2" className="drop-shadow-lg" />
                             <text x="0" y="-1" textAnchor="middle" fontSize="8" className="animate-flash-text font-black">{alertLines[0]}</text>
                             <text x="0" y="9" textAnchor="middle" fontSize="7" className="fill-red-800 font-bold">{alertLines[1]}</text>
                        </g>
                    )}
                </g>
            );

            const LimitSwitch = ({ x, y, active, id, areValvesOpen }) => {
                const isBypassOpen = active;
                const status = maintenanceStatus[id];
                let bgColor = "#16a34a";
                let textPrimary = "SCADA: BAJPAS ZAMKNIĘTY";
                let textSecondary = "";
                let textTertiary = "";
                let showButton = false;
                let btnText = "";
                let animateClass = "";
                let isUrgent = false;

                if (isBypassOpen) {
                    if (status === 'IDLE') {
                        bgColor = "#dc2626"; textPrimary = "SCADA: ZAWÓR OTWARTY!"; textSecondary = "POTWIERDŹ TRYB SERWISOWY"; showButton = true; btnText = "POTWIERDŹ SERWIS";
                    } 
                    else if (status === 'ACKNOWLEDGED') {
                        if (areValvesOpen) {
                            bgColor = "#f97316"; textPrimary = "ZAMKNIJ ZAWORY!"; textSecondary = `Z${id}.1 i Z${id}.2 muszą być zamknięte!`; textTertiary = "ZAMKNIJ TE ZAWORY I POTWIERDŹ NA SCHEMACIE"; animateClass = "animate-flash-rect"; isUrgent = true;
                        } else {
                            bgColor = "#3b82f6"; textPrimary = "FILTR ODIZOLOWANY"; textSecondary = "MOŻNA WYMIENIAĆ ZŁOŻE"; showButton = true; btnText = "ZAKOŃCZ SERWIS";
                        }
                    }
                    else if (status === 'RESTORING') {
                        if (!areValvesOpen) {
                            bgColor = "#f97316"; textPrimary = "KROK 1: OTWÓRZ ZAWORY"; textSecondary = `Z${id}.1 i Z${id}.2 (Kliknij je)`; animateClass = "animate-flash-rect";
                        } else {
                            bgColor = "#eab308"; textPrimary = "KROK 2: ZAMKNIJ BAJPAS"; textSecondary = `Zamknij Z${id}.3 (Kliknij go)`; animateClass = "animate-flash-rect";
                        }
                    }
                }

                const boxWidth = 260;
                let boxHeight = 25;
                if (isBypassOpen) boxHeight = textTertiary ? 90 : 60;

                return (
                    <g transform={`translate(${x}, ${y})`}>
                        <path d="M 0 0 L 0 -20" stroke="#f59e0b" strokeWidth="2" strokeDasharray="3,2" />
                        <rect x="-12" y="-12" width="24" height="24" fill="#fef3c7" stroke="#d97706" strokeWidth="2" rx="2" />
                        <text x="0" y="4" textAnchor="middle" fontSize="10" fontWeight="bold" fill="#b45309">LS</text>
                        <circle cx="0" cy="-20" r="4" fill={active ? "#22c55e" : "#ef4444"} stroke="#fff" strokeWidth="1" />
                        <g transform={`translate(0, -${boxHeight + 25})`}>
                            <rect x={-boxWidth/2} y="0" width={boxWidth} height={boxHeight} rx="4" fill={bgColor} stroke="white" strokeWidth="1" opacity="0.95" className={`shadow-lg ${animateClass}`} />
                            <text x="0" y="16" textAnchor="middle" fontSize="11" fill="white" fontWeight="bold" style={{textShadow: '0px 1px 2px rgba(0,0,0,0.5)'}}>{textPrimary}</text>
                            {textSecondary && <text x="0" y="32" textAnchor="middle" fontSize="10" fill="white" style={{textShadow: '0px 1px 2px rgba(0,0,0,0.5)'}}>{textSecondary}</text>}
                            {textTertiary && <text x="0" y="50" textAnchor="middle" fontSize="11" fontWeight="bold" fill={isUrgent ? "#7f1d1d" : "white"} style={{textShadow: isUrgent ? '0px 0px 3px rgba(255,255,255,0.9)' : '0px 1px 2px rgba(0,0,0,0.5)'}}>{textTertiary}</text>}
                            {showButton && <g onClick={(e) => { e.stopPropagation(); advanceMaintenance(id); }} className="cursor-pointer hover:opacity-80" transform={`translate(0, ${boxHeight - 20})`}><rect x="-60" y="0" width="120" height="16" rx="8" fill="white" stroke="#333" strokeWidth="0.5" /><text x="0" y="11" textAnchor="middle" fontSize="9" fill="black" fontWeight="bold">{btnText}</text></g>}
                        </g>
                    </g>
                );
            };

            const TankIso = ({ x, y, label }) => {
                const w = 60; const h = 100;
                return (
                <g>
                    <ellipse cx={x} cy={y} rx={w/2 + 5} ry="10" fill="black" opacity="0.1" />
                    <path d={`M ${x-20} ${y} L ${x-20} ${y+15}`} stroke="#475569" strokeWidth="4" />
                    <path d={`M ${x+20} ${y} L ${x+20} ${y+15}`} stroke="#475569" strokeWidth="4" />
                    <rect x={x-25} y={y+15} width="10" height="4" fill="#64748b" />
                    <rect x={x+15} y={y+15} width="10" height="4" fill="#64748b" />
                    <path d={`M ${x-w/2} ${y-h} L ${x-w/2} ${y} A ${w/2} 10 0 0 0 ${x+w/2} ${y} L ${x+w/2} ${y-h}`} fill="#1e293b" stroke="#0f172a" strokeWidth="2" />
                    <path d={`M ${x-w/2} ${y-h} L ${x} ${y-h-25} L ${x+w/2} ${y-h}`} fill="#334155" stroke="#0f172a" strokeWidth="2" />
                    <path d={`M ${x-w/2} ${y-h} A ${w/2} 8 0 0 0 ${x+w/2} ${y-h} A ${w/2} 8 0 0 0 ${x-w/2} ${y-h}`} fill="#1e293b" stroke="#0f172a" />
                    <rect x={x-8} y={y-h-35} width="16" height="10" fill="#475569" stroke="black" />
                    <ellipse cx={x} cy={y-h-35} rx="8" ry="3" fill="#94a3b8" stroke="black" />
                    <path d={`M ${x+w/2} ${y-20} L ${x+w/2+10} ${y-20} L ${x+w/2+10} ${y-10} L ${x+w/2} ${y-10}`} fill="#475569" stroke="black" />
                    <ellipse cx={x+w/2+10} cy={y-15} rx="2" ry="5" fill="#64748b" />
                    <text x={x} y={y-h/2} textAnchor="middle" fill="white" opacity="0.3" fontSize="16" fontWeight="bold">{label}</text>
                </g>
                );
            };

            const PumpIso = ({ x, y, active, id, label }) => (
                <g onClick={() => togglePump(id)} className="cursor-pointer group">
                    <rect x={x-20} y={y-15} width="40" height="30" fill={active ? "#eab308" : "#94a3b8"} stroke={active ? "#854d0e" : "#475569"} strokeWidth="2" rx="2" className="transition-colors duration-300" />
                    <path d={`M ${x+20} ${y-15} L ${x+25} ${y-20} L ${x+25} ${y+10} L ${x+20} ${y+15} Z`} fill={active ? "#ca8a04" : "#64748b"} className="transition-colors duration-300" />
                    <circle cx={x} cy={y} r="10" fill="#1f2937" stroke="#000" />
                    {active && <circle cx={x} cy={y} r="4" fill="#ef4444" className="animate-pulse" />}
                    <rect x={x-25} y={y+15} width="50" height="5" fill="#374151" />
                    <text x={x} y={y-25} textAnchor="middle" className="text-[10px] font-bold fill-slate-600">{label}</text>
                    <text x={x} y={y+35} textAnchor="middle" className={`text-[9px] font-bold ${active ? 'fill-green-600' : 'fill-slate-400'}`}>{active ? "ON" : "OFF"}</text>
                </g>
            );

            const TedomEngine = ({ x, y, active }) => (
                <g transform={`translate(${x}, ${y})`}>
                <rect x="0" y="0" width="130" height="90" rx="4" fill={active ? "#f0fdf4" : "#fef2f2"} stroke={active ? "#16a34a" : "#dc2626"} strokeWidth="2" />
                <text x="65" y="-12" textAnchor="middle" fontWeight="bold" fill="#334155" fontSize="12">SILNIK TEDOM</text>
                <rect x="10" y="20" width="110" height="50" fill={active ? "#22c55e" : "#ef4444"} rx="2" className="transition-colors duration-500" />
                <rect x="15" y="25" width="100" height="5" fill="black" opacity="0.1" />
                <rect x="15" y="35" width="100" height="5" fill="black" opacity="0.1" />
                <rect x="15" y="45" width="100" height="5" fill="black" opacity="0.1" />
                <text x="65" y="52" textAnchor="middle" fill="white" fontWeight="bold" fontSize="12" className="pointer-events-none">{active ? "PRACA" : "BRAK GAZU"}</text>
                {!active && (<g transform="translate(100, -10)"><circle r="12" fill="#ef4444" stroke="white" strokeWidth="2" /><text x="0" y="4" textAnchor="middle" fill="white" fontSize="14" fontWeight="bold">!</text><animateTransform attributeName="transform" type="scale" values="1;1.2;1" dur="1s" repeatCount="indefinite" additive="sum" /></g>)}
                <path d="M 90 20 L 90 -25 L 110 -25" fill="none" stroke="#64748b" strokeWidth="6" />
                {active && (<g><circle cx="115" cy="-25" r="3" fill="#94a3b8" opacity="0.6"><animate attributeName="cy" from="-25" to="-45" dur="1.5s" repeatCount="indefinite" /><animate attributeName="opacity" from="0.6" to="0" dur="1.5s" repeatCount="indefinite" /><animate attributeName="r" from="3" to="8" dur="1.5s" repeatCount="indefinite" /></circle><circle cx="115" cy="-25" r="2" fill="#94a3b8" opacity="0.4"><animate attributeName="cy" from="-25" to="-40" dur="1.5s" begin="0.5s" repeatCount="indefinite" /><animate attributeName="opacity" from="0.4" to="0" dur="1.5s" begin="0.5s" repeatCount="indefinite" /><animate attributeName="r" from="2" to="6" dur="1.5s" begin="0.5s" repeatCount="indefinite" /></circle></g>)}
                </g>
            );

            return (
                <div className="flex flex-col items-center p-6 bg-slate-50 rounded-xl shadow-lg w-full border border-slate-200">
                
                <div className="w-full flex flex-col md:flex-row justify-between items-center mb-6 bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                    <div className="flex items-center gap-4"><EnerisLogo /></div>
                    <div className="flex-1 text-center md:text-left md:ml-4">
                        <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2 md:justify-start justify-center"><IconSettings />Wizualizacja pracy filtrów biogazu Balin</h2>
                        <div className={`mt-2 inline-flex items-center px-4 py-2 rounded-lg text-sm font-bold border ${currentScenario.color} shadow-sm gap-2`}>{currentScenario.showIcon && (<IconAlert />)}<span>STATUS UKŁADU: {currentScenario.text}</span></div>
                        {valveWarnings.length > 0 && (<div className="mt-3 bg-red-50 border border-red-200 rounded-lg p-2 text-sm text-red-800 animate-pulse text-left">{valveWarnings.map((warning, idx) => (<div key={idx} className="flex items-start gap-2"><IconWarningSmall /><span>{warning}</span></div>))}</div>)}
                    </div>
                    <div className="flex flex-col items-end gap-2 mt-4 md:mt-0">
                        <div className="font-bold text-slate-500 text-sm mb-1">Resja sp. z o.o.</div>
                        <div className="flex gap-3 text-xs font-bold"><div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-500 rounded-full"></div> OTWARTY</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-red-500 rounded-full"></div> ZAMKNIĘTY</div></div>
                        <div className="flex gap-3 text-xs font-bold"><div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-500 rounded-full"></div> DMUCHAWA ON</div><div className="flex items-center gap-1"><div className="w-3 h-3 bg-slate-400 rounded-full"></div> DMUCHAWA OFF</div></div>
                    </div>
                </div>

                <div className="w-full overflow-x-auto bg-white rounded-lg border border-slate-200 p-4 shadow-inner mb-6">
                    <svg viewBox="0 -100 1000 550" className="w-full min-w-[950px]">
                    <path d="M 50 350 L 850 350 L 880 330 L 80 330 Z" fill="#e2e8f0" stroke="#cbd5e1" /><path d="M 50 350 L 50 360 L 850 360 L 850 350" fill="#cbd5e1" stroke="#94a3b8" />
                    <rect x="100" y="360" width="40" height="15" fill="#cbd5e1" /><rect x="300" y="360" width="40" height="15" fill="#cbd5e1" /><rect x="500" y="360" width="40" height="15" fill="#cbd5e1" /><rect x="700" y="360" width="40" height="15" fill="#cbd5e1" />

                    <text x="20" y="245" fontSize="10" fontWeight="bold" fill="#64748b">WLOT</text>
                    <Pipe d="M 10 250 L 40 250" active={hasGasInlet} thick={8} />
                    <Pipe d="M 40 250 L 40 220 L 60 220" active={hasGasInlet} thick={6} /><PumpIso x={80} y={230} active={isP1Working} id="p1" label="DMUCHAWA GAZU 1" /><Pipe d="M 100 220 L 120 220 L 120 240" active={isP1Working} thick={6} />
                    <Pipe d="M 40 250 L 40 280 L 60 280" active={hasGasInlet} thick={6} /><PumpIso x={80} y={290} active={isP2Working} id="p2" label="DMUCHAWA GAZU 2" /><Pipe d="M 100 280 L 120 280 L 120 260" active={isP2Working} thick={6} />
                    <Pipe d="M 120 250 L 140 250 L 140 90 L 160 90" active={hasGasAfterPumps} thick={8} />

                    <Pipe d="M 160 90 L 300 90" active={hasGasAfterPumps && valves.f1_byp} /><Pipe d="M 300 90 L 360 90" active={(hasGasAfterPumps && valves.f1_byp) || (hasGasAfterPumps && valves.f1_in && valves.f1_out)} />
                    <Pipe d="M 160 90 L 160 145" active={hasGasAfterPumps} /><Pipe d="M 160 145 L 230 145 L 230 155" active={hasGasAfterPumps && valves.f1_in} /><Pipe d="M 270 275 L 300 275 L 300 90" active={hasGasAfterPumps && valves.f1_in && valves.f1_out} />
                    <TankIso x={230} y={290} label="F1" />
                    <Valve x={230} y={90} id="f1_byp" isOpen={valves.f1_byp} code="Z1.3" />
                    <LimitSwitch x={230} y={60} active={valves.f1_byp} id="1" areValvesOpen={valves.f1_in || valves.f1_out} />
                    <Valve x={160} y={130} id="f1_in" isOpen={valves.f1_in} code="Z1.1" vertical={true} alertLines={getValveAlert('f1_in')} />
                    <Valve x={300} y={240} id="f1_out" isOpen={valves.f1_out} code="Z1.2" vertical={true} alertLines={getValveAlert('f1_out')} />

                    <Pipe d="M 360 90 L 400 90" active={hasGasAfterF1} thick={8} />

                    <Pipe d="M 400 90 L 540 90" active={hasGasAfterF1 && valves.f2_byp} /><Pipe d="M 540 90 L 600 90" active={(hasGasAfterF1 && valves.f2_byp) || (hasGasAfterF1 && valves.f2_in && valves.f2_out)} />
                    <Pipe d="M 400 90 L 400 145" active={hasGasAfterF1} /><Pipe d="M 400 145 L 470 145 L 470 155" active={hasGasAfterF1 && valves.f2_in} /><Pipe d="M 510 275 L 540 275 L 540 90" active={hasGasAfterF1 && valves.f2_in && valves.f2_out} />
                    <TankIso x={470} y={290} label="F2" />
                    <Valve x={470} y={90} id="f2_byp" isOpen={valves.f2_byp} code="Z2.3" />
                    <LimitSwitch x={470} y={60} active={valves.f2_byp} id="2" areValvesOpen={valves.f2_in || valves.f2_out} />
                    <Valve x={400} y={130} id="f2_in" isOpen={valves.f2_in} code="Z2.1" vertical={true} alertLines={getValveAlert('f2_in')} />
                    <Valve x={540} y={240} id="f2_out" isOpen={valves.f2_out} code="Z2.2" vertical={true} alertLines={getValveAlert('f2_out')} />

                    <Pipe d="M 600 90 L 640 90" active={hasGasAfterF2} thick={8} />

                    <Pipe d="M 640 90 L 780 90" active={hasGasAfterF2 && valves.f3_byp} /><Pipe d="M 780 90 L 820 90" active={(hasGasAfterF2 && valves.f3_byp) || (hasGasAfterF2 && valves.f3_in && valves.f3_out)} />
                    <Pipe d="M 640 90 L 640 145" active={hasGasAfterF2} /><Pipe d="M 640 145 L 710 145 L 710 155" active={hasGasAfterF2 && valves.f3_in} /><Pipe d="M 750 275 L 780 275 L 780 90" active={hasGasAfterF2 && valves.f3_in && valves.f3_out} />
                    <TankIso x={710} y={290} label="F3" />
                    <Valve x={710} y={90} id="f3_byp" isOpen={valves.f3_byp} code="Z3.3" />
                    <LimitSwitch x={710} y={60} active={valves.f3_byp} id="3" areValvesOpen={valves.f3_in || valves.f3_out} />
                    <Valve x={640} y={130} id="f3_in" isOpen={valves.f3_in} code="Z3.1" vertical={true} alertLines={getValveAlert('f3_in')} />
                    <Valve x={780} y={240} id="f3_out" isOpen={valves.f3_out} code="Z3.2" vertical={true} alertLines={getValveAlert('f3_out')} />

                    <Pipe d="M 820 90 L 870 90" active={hasGasOutlet} thick={8} />
                    <TedomEngine x={870} y={45} active={hasGasOutlet} />
                    </svg>
                </div>

                <div className="w-full bg-white rounded-lg border border-slate-200 overflow-hidden shadow-sm">
                    <div className="bg-slate-100 p-3 border-b border-slate-200 flex items-center gap-2"><IconFileText /><h3 className="font-bold text-slate-700">Tabela Scenariuszy (Ściąga)</h3></div>
                    <div className="p-3 bg-blue-50 text-sm border-b border-blue-100 mb-2 text-blue-800"><h4 className="font-bold flex items-center gap-2"><IconSettings className="w-4 h-4" /> SCADA - Sygnały Krańcówek</h4><p className="mt-1 text-xs">System SCADA odczytuje stan filtrów na podstawie krańcówek (LS) zamontowanych na zaworach BYPASS. LS=0 (Zamknięty) -> Filtr pracuje. LS=1 (Otwarty) -> Filtr pominięty.</p></div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left">
                            <thead className="bg-slate-50 text-slate-600 font-bold border-b">
                                <tr>
                                    <th className="p-3">Tryb Pracy</th><th className="p-3 text-center bg-blue-50">F1 Bypass (LS)</th><th className="p-3 text-center bg-blue-50">F2 Bypass (LS)</th><th className="p-3 text-center bg-blue-50">F3 Bypass (LS)</th><th className="p-3 text-left">Opis konfiguracji</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 1 ? 'bg-green-50' : ''}`}><td className="p-3 font-semibold text-slate-800">1. Praca Pełna</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-gray-600">Pracują F1, F2, F3.</td></tr>
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 2 ? 'bg-blue-50' : ''}`}><td className="p-3 font-semibold text-slate-800">2. Serwis F1</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-gray-600">Pracują F2, F3. F1 pominięty.</td></tr>
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 3 ? 'bg-blue-50' : ''}`}><td className="p-3 font-semibold text-slate-800">3. Serwis F2</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-gray-600">Pracują F1, F3. F2 pominięty.</td></tr>
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 4 ? 'bg-blue-50' : ''}`}><td className="p-3 font-semibold text-slate-800">4. Serwis F3</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-gray-600">Pracują F1, F2. F3 pominięty.</td></tr>
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 5 ? 'bg-orange-50' : ''}`}><td className="p-3 font-semibold text-slate-800">5. Tylko F1</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-gray-600">Pracuje tylko F1. F2 i F3 pominięte.</td></tr>
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 6 ? 'bg-orange-50' : ''}`}><td className="p-3 font-semibold text-slate-800">6. Tylko F2</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-gray-600">Pracuje tylko F2. F1 i F3 pominięte.</td></tr>
                                <tr className={`hover:bg-slate-50 ${currentScenario.id === 7 ? 'bg-orange-50' : ''}`}><td className="p-3 font-semibold text-slate-800">7. Tylko F3</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-red-500">ZAM (0)</td><td className="p-3 text-gray-600">Pracuje tylko F3. F1 i F2 pominięte.</td></tr>
                                <tr className={`hover:bg-red-100 ${currentScenario.id === 8 ? 'bg-red-50' : ''}`}><td className="p-3 font-semibold text-red-900">8. Pełny Bypass</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-center font-bold text-green-600">OTW (1)</td><td className="p-3 text-gray-600">Gaz omija wszystkie filtry.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProcessDiagram />);
    </script>
</body>
